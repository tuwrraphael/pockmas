{"version":3,"file":"84b8eb1addeafebf6d60.bundle.js","mappings":"yKAIM,MAAOA,EACTC,cACS,KAAAC,KAAI,G,wCCCX,MAAOC,UAAyBC,YAMlCH,cACII,QANI,KAAAC,UAAW,EASnBC,oBACIC,KAAKC,gBAAkB,IAAIC,gBACtBF,KAAKF,WACNE,KAAKG,UCnBN,0CDoBCH,KAAKF,UAAW,EAChBE,KAAKI,iBAAmBJ,KAAKK,cAAc,sBAE/CL,KAAKM,SAGDA,SACAN,KAAKF,UAAYE,KAAKO,WACtBP,KAAKI,iBAAiBI,OAAOR,KAAKO,WAI1CC,OAAOC,GACHT,KAAKO,UAAYE,EACjBT,KAAKM,SAGTI,uBACIV,KAAKC,gBAAgBU,SAI7BC,eAAeC,OAAO,oBAAqBlB,GElCrC,MAAOmB,UAA6BlB,YAUtCH,cACII,QAVI,KAAAC,UAAW,EAGX,KAAAiB,WAA0B,GAG1B,KAAAC,gBAAkB,EAClB,KAAAC,iBAA2B,KAI/BjB,KAAKkB,MAAQC,EAAAA,EAAAA,cAGTC,wBACJpB,KAAKkB,MAAMG,WAAW,IAAI7B,GAG9BO,oBACIC,KAAKC,gBAAkB,IAAIC,gBAC3BF,KAAKsB,qBAAuB,IAAIC,sBAAsBC,IAClD,GAAIA,EAAcC,MAAKC,GAAKA,EAAEC,iBAAiB,CAC3C,GAAI3B,KAAKgB,iBAAmBhB,KAAKe,WAAWa,OACxC,OAEA5B,KAAKoB,wBAETpB,KAAKgB,gBAAkBhB,KAAKe,WAAWa,UAE5C,CACCC,KAAM,KACNC,UAAW,IAEV9B,KAAKF,WACNE,KAAKG,UC3CN,GD4CCH,KAAKF,UAAW,EAChBE,KAAK+B,SAAW,IAAIC,EAAAA,EAA4DhC,MAAMiC,GAAKjC,KAAKe,WAAWmB,QAAQD,KAAIA,GAC3G,IAAItC,KAIpBK,KAAKkB,MAAMiB,WAAU,CAACC,EAAGC,IAAMrC,KAAKQ,OAAO4B,EAAGC,IAAIrC,KAAKC,gBAAgBqC,QACvEtC,KAAKuC,KAAKvC,KAAKkB,MAAMsB,OAIjBC,WAAWL,IACVA,MAAAA,OAAC,EAADA,EAAGrB,cAGRf,KAAKe,WAAaqB,EAAErB,WACpBf,KAAK+B,SAASvB,OAAOR,KAAKe,YAAY,CAACsB,EAAGX,KACtCW,EAAE7B,OAAOkB,MAEb1B,KAAKsB,qBAAqBoB,aACtB1C,KAAK2C,kBACL3C,KAAKsB,qBAAqBsB,QAAQ5C,KAAK2C,mBAKvCnC,OAAO4B,EAAUC,G,QACjBA,EAAEQ,SAAS,eACX7C,KAAKyC,WAAWL,GAEhBC,EAAEQ,SAAS,wBACuB,QAA9B,EAAAT,EAAEU,mBAAmBvC,iBAASwC,IAAAA,OAAA,EAAAA,EAAEC,KAAMhD,KAAKiB,mBAC3CjB,KAAKiB,iBAAiD,QAA9B,EAAAmB,EAAEU,mBAAmBvC,iBAAS0C,IAAAA,OAAA,EAAAA,EAAED,GACxDhD,KAAKgB,gBAAkB,GAK3BuB,KAAKH,GACTpC,KAAKyC,WAAWL,GAGpB1B,uBACIV,KAAKC,gBAAgBU,QACrBX,KAAKsB,qBAAqBoB,cAIlC9B,eAAeC,OAAO,yBAA0BC","sources":["webpack://pockmas/./src/state/actions/DisplayMoreDepartures.ts","webpack://pockmas/./src/components/DepartureSummary/DepartureSummary.ts","webpack://pockmas/./src/components/DepartureSummary/DepartureSummary.html","webpack://pockmas/./src/components/DepartureResultsList/DepartureResultsList.ts","webpack://pockmas/./src/components/DepartureResultsList/DepartureResultsList.html"],"sourcesContent":["import { Action } from \"./Action\";\nimport { ActionType } from \"./ActionType\";\n\n\nexport class DisplayMoreDepartures implements Action {\n    constructor() { }\n    readonly type = ActionType.DisplayMoreDepartures;\n}\n","import template from \"./DepartureSummary.html\";\nimport \"./DepartureSummary.scss\";\nimport \"../FlipTimeDisplay/FlipTimeDisplay\";\nimport { Departure } from \"../../lib/Departure\";\nimport \"../DepartureDisplay/DepartureDisplay\";\nimport { DepartureDisplay } from \"../DepartureDisplay/DepartureDisplay\";\n\nexport class DepartureSummary extends HTMLElement {\n    private rendered = false;\n    private abortController: AbortController;\n    private departureDisplay: DepartureDisplay;\n    private departure: Departure;\n\n    constructor() {\n        super();\n    }\n\n    connectedCallback() {\n        this.abortController = new AbortController();\n        if (!this.rendered) {\n            this.innerHTML = template;\n            this.rendered = true;\n            this.departureDisplay = this.querySelector(\"departure-display\");\n        }\n        this.render();\n    }\n\n    private render() {\n        if (this.rendered && this.departure) {\n            this.departureDisplay.update(this.departure);\n        }\n    }\n\n    update(data: Departure) {\n        this.departure = data;\n        this.render();\n    }\n\n    disconnectedCallback() {\n        this.abortController.abort();\n    }\n}\n\ncustomElements.define(\"departure-summary\", DepartureSummary);\n","// Module\nvar code = \"<departure-display></departure-display>\";\n// Exports\nexport default code;","import { Departure } from \"../../lib/Departure\";\nimport { DisplayMoreDepartures } from \"../../state/actions/DisplayMoreDepartures\";\nimport { State, StateChanges } from \"../../state/State\";\nimport { Store } from \"../../state/Store\";\nimport { ArrayToElementRenderer } from \"../../utils/ArrayToElementRenderer\";\nimport { DepartureSummary } from \"../DepartureSummary/DepartureSummary\";\nimport template from \"./DepartureResultsList.html\";\nimport \"./DepartureResultsList.scss\";\n\nexport class DepartureResultsList extends HTMLElement {\n    private rendered = false;\n    private store: Store;\n    private abortController: AbortController;\n    private departures: Departure[] = [];\n    private renderer: ArrayToElementRenderer<Departure, DepartureSummary, number>;\n    private intersectionObserver: IntersectionObserver;\n    private moreRequestedAt = 0;\n    private lastSelectedDest: number = null;\n\n    constructor() {\n        super();\n        this.store = Store.getInstance();\n    }\n\n    private requestMoreDepartures() {\n        this.store.postAction(new DisplayMoreDepartures());\n    }\n\n    connectedCallback() {\n        this.abortController = new AbortController();\n        this.intersectionObserver = new IntersectionObserver((intersections) => {\n            if (intersections.some(i => i.isIntersecting)) {\n                if (this.moreRequestedAt >= this.departures.length) {\n                    return;\n                } else {\n                    this.requestMoreDepartures();\n                }\n                this.moreRequestedAt = this.departures.length;\n            }\n        }, {\n            root: null,\n            threshold: 1.0\n        });\n        if (!this.rendered) {\n            this.innerHTML = template;\n            this.rendered = true;\n            this.renderer = new ArrayToElementRenderer<Departure, DepartureSummary, number>(this, e => this.departures.indexOf(e), e => {\n                let s = new DepartureSummary();\n                return s;\n            });\n        }\n        this.store.subscribe((s, c) => this.update(s, c), this.abortController.signal);\n        this.init(this.store.state);\n\n    }\n\n    private setResults(s: State) {\n        if (!s?.departures) {\n            return;\n        }\n        this.departures = s.departures;\n        this.renderer.update(this.departures, (c, i) => {\n            c.update(i);\n        });\n        this.intersectionObserver.disconnect();\n        if (this.lastElementChild) {\n            this.intersectionObserver.observe(this.lastElementChild);\n        }\n\n    }\n\n    private update(s: State, c: StateChanges) {\n        if (c.includes(\"departures\")) {\n            this.setResults(s);\n        }\n        if (c.includes(\"selectedStopgroups\")) {\n            if (s.selectedStopgroups.departure?.id != this.lastSelectedDest) {\n                this.lastSelectedDest = s.selectedStopgroups.departure?.id;\n                this.moreRequestedAt = 0;\n            }\n        }\n    }\n\n    private init(s: State) {\n        this.setResults(s);\n    }\n\n    disconnectedCallback() {\n        this.abortController.abort();\n        this.intersectionObserver.disconnect();\n    }\n}\n\ncustomElements.define(\"departure-results-list\", DepartureResultsList);","// Module\nvar code = \"\";\n// Exports\nexport default code;"],"names":["DisplayMoreDepartures","constructor","type","DepartureSummary","HTMLElement","super","rendered","connectedCallback","this","abortController","AbortController","innerHTML","departureDisplay","querySelector","render","departure","update","data","disconnectedCallback","abort","customElements","define","DepartureResultsList","departures","moreRequestedAt","lastSelectedDest","store","Store","requestMoreDepartures","postAction","intersectionObserver","IntersectionObserver","intersections","some","i","isIntersecting","length","root","threshold","renderer","ArrayToElementRenderer","e","indexOf","subscribe","s","c","signal","init","state","setResults","disconnect","lastElementChild","observe","includes","selectedStopgroups","_a","id","_b"],"sourceRoot":""}