!function(){"use strict";var t,e,r,n,a={8531:function(t,e,r){r(3948),r(285),r(1637),r(5306),r(8255),r(3824);var n=r(9684);async function a(t,e,r,n){let a,i=e.body.getReader(),o=!1,s=[],u=new Uint8Array(4*r),l=0;for(;!o;){let e=await i.read();if(o=e.done,e.done)break;let c=e.value;if(0==s.length){if(u.set(c.slice(0,Math.min(4*r-l,c.byteLength)),l),l+=c.byteLength,l<4*r)continue;{let t=new DataView(u.buffer);for(let e=0;e<r;e++)s.push(t.getUint32(4*e,!0));c=c.slice(4*r-l)}}s.length>0&&null==a&&(a=n(t,s)),null!=a&&(new Uint8Array(t.exports.memory.buffer,a,c.length).set(c),a+=c.length)}}r(2472);function i(t){let e=0;return e=0==t.getDay()?64:1<<t.getDay()-1,e}class o{constructor(t,e,r){this.routingInstance=t,this.routeNames=e,this.stops=r}getStartOfDayVienna(t){const e=(0,n.yQ)("Europe/Vienna"),r=(0,n.iN)(t,e);return(0,n.ZG)({year:r.year,month:r.month,day:r.day,hours:0,minutes:0,seconds:0},e)}route(t){performance.mark("routing-start");let e=this.routingInstance.exports.get_request_memory(),r=new DataView(this.routingInstance.exports.memory.buffer,e,168);r.setUint8(0,0),r.setUint8(1,Math.min(20,t.departureStops.length)),r.setUint8(2,1),r.setUint8(3,i(t.departureTimes[0]));for(let e=0;e<Math.min(20,t.departureStops.length);e++)r.setUint16(4+2*e,t.departureStops[e],!0);r.setUint16(44,t.arrivalStop,!0);let n=this.getStartOfDayVienna(t.departureTimes[0]),a=n/1e3;for(let e=0;e<Math.min(20,t.departureStops.length);e++){let a=(+t.departureTimes[e]-n)/1e3;r.setUint32(84+4*e,a,!0)}r.setUint32(164,a,!0);let o=this.routingInstance.exports.raptor();performance.mark("routing-done");let s=performance.measure("routing","routing-start","routing-done");return console.log("routing took ".concat(s.duration,"ms")),this.readResults(this.routingInstance.exports.memory,o,n)}readLeg(t,e,r){let n=new DataView(t,e,24),a=n.getUint16(4,!0),i=n.getUint16(6,!0),o=n.getUint32(8,!0),s=n.getUint32(12,!0),u={type:n.getUint32(0,!0),departureStop:{stopId:a,stopName:this.stops[a][0]},arrivalStop:{stopId:i,stopName:this.stops[i][0]},plannedDeparture:new Date(1e3*o),delay:n.getUint16(18,!0),arrivalTime:new Date(r+1e3*s),duration:1e3*(r/1e3+s-o),route:null,tripId:null};if(1==u.type){let t=n.getUint16(16,!0);u.route={name:this.routeNames[t][0],color:this.routeNames[t].length>3?this.routeNames[t][3]:0==this.routeNames[t][2]?"c4121a":"",id:t,headsign:this.routeNames[t][1]},u.tripId=n.getUint32(20,!0)}return u}readItinerary(t,e,r){let n=[],a=new DataView(t,e,244).getUint32(0,!0);for(let i=0;i<a;i++)n.push(this.readLeg(t,e+4+24*i,r));return{legs:n.reverse()}}readResults(t,e,r){let n=[],a=new DataView(t.buffer,e,1956).getUint32(0,!0);for(let i=0;i<a;i++){let a=this.readItinerary(t.buffer,e+4+244*i,r);n.push(a)}return n}readStoptimeUpdate(t,e){let r=new DataView(t,e,81),n=r.getUint16(0,!0),a=r.getUint16(2,!0),i=r.getInt16(4,!0);return{routeId:n,route:this.routeNames[n][0],trip:a,realtimeOffset:i}}getRealtimeUpdateResult(){let t=this.routingInstance.exports.get_stoptime_update_memory(),e=new DataView(this.routingInstance.exports.memory.buffer,t,81),r=e.getUint8(13),n=[];for(let a=0;a<r;a++){let r=this.readStoptimeUpdate(this.routingInstance.exports.memory.buffer,t+16+20+8*a);n.push(Object.assign(Object.assign({},r),{numMatches:e.getUint8(76+a)}))}return n}upsertRealtimeData(t){let e=this.routingInstance.exports.get_stoptime_update_memory(),r=new DataView(this.routingInstance.exports.memory.buffer,e,81);r.setUint32(0,t.diva,!0),r.setUint16(4,t.linie,!0),r.setUint8(6,t.direction);let n=this.getStartOfDayVienna(t.timeReal[0]),a=i(t.timeReal[0]);r.setUint8(7,a),r.setUint32(8,n/1e3,!0),r.setUint8(12,t.apply?1:0);let o=Math.min(t.timeReal.length,5);r.setUint8(13,o);for(let e=0;e<o;e++)r.setUint32(16+4*e,(+t.timeReal[e]-n)/1e3,!0);this.routingInstance.exports.process_realtime()}}let s,u,l,c="",p={arrivalStopResults:[],departureStopResults:[],results:[]};function f(t){let e=t(p);p=Object.assign(Object.assign({},p),e),self.postMessage([e,Object.keys(e)])}function g(t,e){if(null==s)return;let r,n=t.toLowerCase().replace(/ä/g,"a").replace(/ö/g,"o").replace(/ü/g,"u").replace(/ß/g,"ss").replace(/[^a-z0-9]/g," ").replace(/ +(?= )/g,"").trim();if(n==c)return;if(n.length==c.length+1&&n.startsWith(c))r=s.exports.stopsearch_step(n.charCodeAt(n.length-1));else{r=s.exports.stopsearch_reset();for(let t=0;t<n.length;t++)r=s.exports.stopsearch_step(n.charCodeAt(t))}c=n;let a=new DataView(s.exports.memory.buffer,r,8),i=a.getUint32(0,!0),o=a.getUint32(4,!0),u=new Uint16Array(s.exports.memory.buffer,o,i),p=[];for(let t=0;t<i;t++){let e=u[t],r=l[e];p.push({id:e,name:r.name})}f((t=>({[e?"departureStopResults":"arrivalStopResults"]:p})))}self.addEventListener("message",(t=>{(async function(t){switch(t.type){case 0:await async function(){if(s)return;let t=fetch(new URL(r(3369),r.b).toString()).then((t=>t.json())).then((t=>l=t)),[e,n]=await Promise.all([WebAssembly.instantiateStreaming(fetch(new URL(r(7981),r.b).toString())),fetch(new URL(r(4156),r.b).toString())]);await Promise.all([t,a(e.instance,n,4,((t,e)=>t.exports.stopsearch_allocate(e[0]/12,e[1],e[3]/2)))]),e.instance.exports.stopsearch_reset(),s=e.instance}();break;case 1:g(t.term,!0);break;case 2:g(t.term,!1);break;case 3:await async function(){if(u)return;let t=fetch(new URL(r(9826),r.b).toString()).then((t=>t.json())),e=fetch(new URL(r(3363),r.b).toString()).then((t=>t.json())),i=r.e(955).then(r.t.bind(r,6955,23)).then((t=>(0,n.wE)(t))),[s,l]=await Promise.all([WebAssembly.instantiateStreaming(fetch(new URL(r(1645),r.b).toString())),fetch(new URL(r(717),r.b).toString())]),[c,p]=await Promise.all([t,e,i,a(s.instance,l,11,((t,e)=>t.exports.raptor_allocate(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10])))]);s.instance.exports.initialize(),u=new o(s.instance,c,p)}();break;case 4:!async function(t,e){if(null==u)return;let r=new Date,n=l[p.departureStopResults[t].id].stopIds,a=l[p.arrivalStopResults[e].id].stopIds[0],i=u.route({arrivalStop:a,departureStops:n,departureTimes:n.map((()=>r))});f((()=>({results:i})))}(t.departure,t.arrival)}})(t.data).catch((t=>console.error(t)))}))},717:function(t,e,r){t.exports=r.p+"data/165a4800ed552c4c8c9b.bmp"},9826:function(t,e,r){t.exports=r.p+"data/6638a393968cbb570992.json"},4156:function(t,e,r){t.exports=r.p+"data/08f2fa00ef5900145597.bmp"},3369:function(t,e,r){t.exports=r.p+"data/088bfbe83d4188f8f284.json"},3363:function(t,e,r){t.exports=r.p+"data/a85a21b1c9b591ab86be.json"},1645:function(t,e,r){t.exports=r.p+"c4dfd2237c689807abfe.wasm"},7981:function(t,e,r){t.exports=r.p+"b66a4079206979081fd1.wasm"}},i={};function o(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return a[t](r,r.exports,o),r.exports}o.m=a,o.x=function(){var t=o.O(void 0,[453,5],(function(){return o(8531)}));return o.O(t)},t=[],o.O=function(e,r,n,a){if(!r){var i=1/0;for(c=0;c<t.length;c++){r=t[c][0],n=t[c][1],a=t[c][2];for(var s=!0,u=0;u<r.length;u++)(!1&a||i>=a)&&Object.keys(o.O).every((function(t){return o.O[t](r[u])}))?r.splice(u--,1):(s=!1,a<i&&(i=a));if(s){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[r,n,a]},r=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__},o.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var a=Object.create(null);o.r(a);var i={};e=e||[null,r({}),r([]),r(r)];for(var s=2&n&&t;"object"==typeof s&&!~e.indexOf(s);s=r(s))Object.getOwnPropertyNames(s).forEach((function(e){i[e]=function(){return t[e]}}));return i.default=function(){return t},o.d(a,i),a},o.d=function(t,e){for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=function(t){return Promise.all(Object.keys(o.f).reduce((function(e,r){return o.f[r](t,e),e}),[]))},o.u=function(t){return{5:"25ba1487fe8f8b80a704",453:"fd03f84bf37ee1bafe74",955:"aca8258eee8d7b804046"}[t]+".bundle.js"},o.miniCssF=function(t){},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="/",function(){o.b=self.location+"";var t={531:1};o.f.i=function(e,r){t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkpockmas=self.webpackChunkpockmas||[],r=e.push.bind(e);e.push=function(e){var n=e[0],a=e[1],i=e[2];for(var s in a)o.o(a,s)&&(o.m[s]=a[s]);for(i&&i(o);n.length;)t[n.pop()]=1;r(e)}}(),n=o.x,o.x=function(){return Promise.all([o.e(453),o.e(5)]).then(n)},o.x()}();
//# sourceMappingURL=79ceab972dc086c6a394.bundle.js.map